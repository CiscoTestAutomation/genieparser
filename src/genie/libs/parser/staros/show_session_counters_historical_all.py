"""starOS implementation of show_session_counters_historical_all.py

"""
import re
from genie.metaparser import MetaParser
from genie.metaparser.util.schemaengine import Any, Or, Schema

class ShowCountersSchema(MetaParser):
    """Schema for show session counters historical all"""

    schema = {
        'session_counters_historical_all': {
            Any(): {
                'TIMESTAMP': str,
                'ARRIVED': str,
                'REJECTED': str,
                'CONNECTED': str,
                'DISCONN': str,
                'FAILED': str
            },
        }    
    }


class ShowCounters(ShowCountersSchema):
    """Parser for show session counters historical all"""

    cli_command = 'show session counters historical all'

    """
                          ------------------- Number of Calls ------------------                             (A+R+D+F+H+R)
Intv  Timestamp              Arrived   Rejected  Connected    Disconn     Failed      Handoffs      Renewals       CallOps 
----  ------------------- ---------- ---------- ---------- ---------- ---------- ------------- ------------- -------------
   1  2022:07:22:07:30:00          2          0          2          2          0             1             0             5
   2  2022:07:22:07:15:00          0          0          0          0          0             0             0             0
   3  2022:07:22:07:00:00          1          0          1          1          0             0             0             2
   4  2022:07:22:06:45:00          1          0          1          1          0             0             0             2
   5  2022:07:22:06:30:00          0          0          0          0          0             0             0             0
   6  2022:07:22:06:15:00          1          0          1          1          0             0             0             2
   7  2022:07:22:06:00:00          1          0          1          1          0             0             0             2
   8  2022:07:22:05:45:00          0          0          0          0          0             0             0             0
   9  2022:07:22:05:30:00          2          0          2          2          0             0             0             4
  10  2022:07:22:05:15:00          0          0          0          0          0             0             0             0
  11  2022:07:22:05:00:00          1          0          1          1          0             0             0             2
  12  2022:07:22:04:45:00          1          0          1          1          0             0             0             2
  13  2022:07:22:04:30:00          0          0          0          0          0             0             0             0
  14  2022:07:22:04:15:00          1          0          1          1          0             0             0             2
  15  2022:07:22:04:00:00          1          0          1          1          0             0             0             2
  16  2022:07:22:03:45:00          0          0          0          0          0             0             0             0
  17  2022:07:22:03:30:00          1          0          1          1          0             0             0             2
  18  2022:07:22:03:15:00          0          0          0          0          0             0             0             0
  19  2022:07:22:03:00:00          1          0          1          1          0             0             0             2
  20  2022:07:22:02:45:00          1          0          1          1          0             0             0             2
  21  2022:07:22:02:30:00          0          0          0          0          0             0             0             0
  22  2022:07:22:02:15:00          1          0          1          1          0             0             0             2
  23  2022:07:22:02:00:00          1          0          1          1          0             0             0             2
  24  2022:07:22:01:45:00          0          0          0          0          0             0             0             0
  25  2022:07:22:01:30:00          1          0          1          1          0             0             0             2
  26  2022:07:22:01:15:00          0          0          0          0          0             0             0             0
  27  2022:07:22:01:00:00          1          0          1          1          0             0             0             2
  28  2022:07:22:00:45:00          1          0          1          1          0             0             0             2
  29  2022:07:22:00:30:00          2          0          2          1          0             0             0             3
  30  2022:07:22:00:15:00          1          0          1          1          0             0             0             2
  31  2022:07:22:00:00:00          1          0          1          1          0             0             0             2
  32  2022:07:21:23:45:00          0          0          0          0          0             0             0             0
  33  2022:07:21:23:30:00          1          0          1          1          0             0             0             2
  34  2022:07:21:23:15:00          0          0          0          0          0             0             0             0
  35  2022:07:21:23:00:00          2          0          2          2          0             0             0             4
  36  2022:07:21:22:45:00          2          0          2          2          0             0             0             4
  37  2022:07:21:22:30:00          0          0          0          0          0             0             0             0
  38  2022:07:21:22:15:00          2          0          2          2          0             0             0             4
  39  2022:07:21:22:00:00          2          0          1          1          0             2             0             5
  40  2022:07:21:21:45:00          1          0          1          1          0             0             0             2
  41  2022:07:21:21:30:00          2          0          2          2          0             0             0             4
  42  2022:07:21:21:15:00          0          0          0          0          0             0             0             0
  43  2022:07:21:21:00:00          2          0          2          3          0             3             0             8
  44  2022:07:21:20:45:00          2          0          2          2          0             0             0             4
  45  2022:07:21:20:30:00          0          0          0          0          0             1             0             1
  46  2022:07:21:20:15:00          2          0          2          2          0             0             0             4
  47  2022:07:21:20:00:00          1          0          1          1          0             0             0             2
  48  2022:07:21:19:45:00          2          0          2          1          0             2             0             5
  49  2022:07:21:19:30:00          2          0          2          2          0             0             0             4
  50  2022:07:21:19:15:00          1          0          0          0          0             2             0             3
  51  2022:07:21:19:00:00          2          0          2          1          0             2             0             5
  52  2022:07:21:18:45:00          1          0          1          2          0             1             0             4
  53  2022:07:21:18:30:00          1          0          1          1          0             1             0             3
  54  2022:07:21:18:15:00          2          0          1          1          0             1             0             4
  55  2022:07:21:18:00:00          2          0          2          2          0             5             0             9
  56  2022:07:21:17:45:00          0          0          0          0          0             0             0             0
  57  2022:07:21:17:30:00          3          0          3          2          0             0             0             5
  58  2022:07:21:17:15:00          1          0          1          1          0             0             0             2
  59  2022:07:21:17:00:00          1          0          1          1          0             0             0             2
  60  2022:07:21:16:45:00          2          0          2          2          0             0             0             4
  61  2022:07:21:16:30:00          1          0          1          1          0             0             0             2
  62  2022:07:21:16:15:00          1          0          1          1          0             0             0             2
  63  2022:07:21:16:00:00          2          0          2          2          0             0             0             4
  64  2022:07:21:15:45:00          1          0          1          1          0             0             0             2
  65  2022:07:21:15:30:00          3          0          3          3          0             0             0             6
  66  2022:07:21:15:15:00          2          0          2          2          0             0             0             4
  67  2022:07:21:15:00:00          2          0          2          3          0             0             0             5
  68  2022:07:21:14:45:00          3          0          3          3          0             0             0             6
  69  2022:07:21:14:30:00          1          0          1          1          0             0             0             2
  70  2022:07:21:14:15:00          2          0          2          2          0             0             0             4
  71  2022:07:21:14:00:00          3          0          3          3          0             0             0             6
  72  2022:07:21:13:45:00          0          0          0          0          0             0             0             0
  73  2022:07:21:13:30:00          3          0          3          3          0             0             0             6
  74  2022:07:21:13:15:00          2          0          2          2          0             0             0             4
  75  2022:07:21:13:00:00          1          0          1          1          0             0             0             2
  76  2022:07:21:12:45:00          3          0          3          4          0             0             0             7
  77  2022:07:21:12:30:00          1          0          1          0          0             4             0             5
  78  2022:07:21:12:15:00          2          0          2          2          0             0             0             4
  79  2022:07:21:12:00:00          2          0          2          2          0             0             0             4
  80  2022:07:21:11:45:00          0          0          0          1          0             5             0             6
  81  2022:07:21:11:30:00          2          0          2          1          0             0             0             3
  82  2022:07:21:11:15:00          2          0          2          2          0             0             0             4
  83  2022:07:21:11:00:00          1          0          1          1          0             0             0             2
  84  2022:07:21:10:45:00          1          0          1          1          0             0             0             2
  85  2022:07:21:10:30:00          1          0          1          1          0             0             0             2
  86  2022:07:21:10:15:00          2          0          2          2          0             0             0             4
  87  2022:07:21:10:00:00          3          0          2          2          0             2             0             7
  88  2022:07:21:09:45:00          1          0          1          1          0             0             0             2
  89  2022:07:21:09:30:00          2          0          2          2          0             0             0             4
  90  2022:07:21:09:15:00          1          0          1          1          0             0             0             2
  91  2022:07:21:09:00:00          1          0          1          1          0             0             0             2
  92  2022:07:21:08:45:00          1          0          1          1          0             0             0             2
  93  2022:07:21:08:30:00          1          0          1          1          0             0             0             2
  94  2022:07:21:08:15:00          2          0          2          2          0             0             0             4
  95  2022:07:21:08:00:00          1          0          1          1          0             2             0             4
  96  2022:07:21:07:45:00          1          0          1          1          0             2             0             4
  97  2022:07:21:07:30:00          2          0          2          2          0             0             0             4
  98  2022:07:21:07:15:00          1          0          1          1          0             2             0             4
  99  2022:07:21:07:00:00          1          0          1          1          0             0             0             2
 100  2022:07:21:06:45:00          1          0          1          1          0             0             0             2
 101  2022:07:21:06:30:00          1          0          1          1          0             0             0             2
 102  2022:07:21:06:15:00          2          0          2          2          0             2             0             6
 103  2022:07:21:06:00:00          1          0          1          1          0             0             0             2
 104  2022:07:21:05:45:00          1          0          1          1          0             0             0             2
 105  2022:07:21:05:30:00          2          0          2          2          0             0             0             4
 106  2022:07:21:05:15:00          1          0          1          1          0             0             0             2
 107  2022:07:21:05:00:00          1          0          1          1          0             0             0             2
 108  2022:07:21:04:45:00          1          0          1          1          0             0             0             2
 109  2022:07:21:04:30:00          1          0          1          1          0             0             0             2
 110  2022:07:21:04:15:00          2          0          2          2          0             0             0             4
 111  2022:07:21:04:00:00          1          0          1          1          0             2             0             4
 112  2022:07:21:03:45:00          1          0          1          1          0             0             0             2
 113  2022:07:21:03:30:00          2          0          2          2          0             0             0             4
 114  2022:07:21:03:15:00          1          0          1          1          0             0             0             2
 115  2022:07:21:03:00:00          1          0          1          1          0             0             0             2
 116  2022:07:21:02:45:00          1          0          1          1          0             0             0             2
 117  2022:07:21:02:30:00          1          0          1          1          0             0             0             2
 118  2022:07:21:02:15:00          2          0          2          2          0             0             0             4
 119  2022:07:21:02:00:00          1          0          1          1          0             0             0             2
 120  2022:07:21:01:45:00          1          0          1          1          0             0             0             2
 121  2022:07:21:01:30:00          2          0          2          2          0             0             0             4
 122  2022:07:21:01:15:00          1          0          1          1          0             0             0             2
 123  2022:07:21:01:00:00          1          0          1          1          0             0             0             2
 124  2022:07:21:00:45:00          1          0          1          2          0             0             0             3
 125  2022:07:21:00:30:00          1          0          1          1          0             0             0             2
 126  2022:07:21:00:15:00          2          0          2          2          0             0             0             4
 127  2022:07:21:00:00:00          1          0          1          1          0             0             0             2
 128  2022:07:20:23:45:00          1          0          1          1          0             0             0             2
 129  2022:07:20:23:30:00          2          0          2          2          0             0             0             4
 130  2022:07:20:23:15:00          1          0          1          1          0             0             0             2
 131  2022:07:20:23:00:00          1          0          1          1          0             0             0             2
 132  2022:07:20:22:45:00          1          0          1          1          0             0             0             2
 133  2022:07:20:22:30:00          2          0          1          2          0             2             0             6
 134  2022:07:20:22:15:00          4          0          3          3          0             5             0            12
 135  2022:07:20:22:00:00          2          0          2          2          0             1             0             5
 136  2022:07:20:21:45:00          3          0          2          2          0             4             0             9
 137  2022:07:20:21:30:00          3          0          2          2          0             2             0             7
 138  2022:07:20:21:15:00          2          0          2          2          0             2             0             6
 139  2022:07:20:21:00:00          2          0          2          2          0             4             0             8
 140  2022:07:20:20:45:00          1          0          1          1          0             5             0             7
 141  2022:07:20:20:30:00          2          0          2          2          0             1             0             5
 142  2022:07:20:20:15:00          4          0          3          2          0             3             0             9
 143  2022:07:20:20:00:00          2          0          2          2          0             1             0             5
 144  2022:07:20:19:45:00          2          0          2          2          0             2             0             6
 145  2022:07:20:19:30:00          3          0          3          3          0             0             0             6
 146  2022:07:20:19:15:00          1          0          1          1          0             0             0             2
 147  2022:07:20:19:00:00          1          0          1          1          0             0             0             2
 148  2022:07:20:18:45:00          1          0          1          1          0             0             0             2
 149  2022:07:20:18:30:00          1          0          1          1          0             0             0             2
 150  2022:07:20:18:15:00          2          0          2          2          0             0             0             4
 151  2022:07:20:18:00:00          1          0          1          1          0             0             0             2
 152  2022:07:20:17:45:00          3          0          3          3          0             2             0             8
 153  2022:07:20:17:30:00          1          0          1          1          0             8             0            10
 154  2022:07:20:17:15:00          2          0          2          1          0             0             0             3
 155  2022:07:20:17:00:00          0          0          0          0          0             0             0             0
 156  2022:07:20:16:45:00          4          0          4          4          0             0             0             8
 157  2022:07:20:16:30:00          1          0          1          2          0             0             0             3
 158  2022:07:20:16:15:00          6          0          6          5          0             0             0            11
 159  2022:07:20:16:00:00          3          0          3          3          0             0             0             6
 160  2022:07:20:15:45:00          0          0          0          0          0             0             0             0
 161  2022:07:20:15:30:00          3          0          3          3          0             0             0             6
 162  2022:07:20:15:15:00          3          0          3          3          0             0             0             6
 163  2022:07:20:15:00:00          0          0          0          0          0             0             0             0
 164  2022:07:20:14:45:00          5          0          5          5          0             0             0            10
 165  2022:07:20:14:30:00          0          0          0          0          0             0             0             0
 166  2022:07:20:14:15:00          4          0          4          4          0             0             0             8
 167  2022:07:20:14:00:00          2          0          2          2          0             0             0             4
 168  2022:07:20:13:45:00          1          0          1          1          0             0             0             2
 169  2022:07:20:13:30:00          4          0          4          4          0             0             0             8
 170  2022:07:20:13:15:00          2          0          2          2          0             0             0             4
 171  2022:07:20:13:00:00          5          0          5          5          0             2             0            12
 172  2022:07:20:12:45:00          8          0          8          8          0             0             0            16
 173  2022:07:20:12:30:00          0          0          0          0          0             2             0             2
 174  2022:07:20:12:15:00          3          0          3          3          0             3             0             9
 175  2022:07:20:12:00:00          3          0          3          1          0             6             0            10
 176  2022:07:20:11:45:00          0          0          0          1          0             7             0             8
 177  2022:07:20:11:30:00          1          0          1          3          0             1             0             5
 178  2022:07:20:11:15:00          6          0          6          6          0             8             0            20
 179  2022:07:20:11:00:00          4          0          4          4          0             5             0            13
 180  2022:07:20:10:45:00          1          0          1          1          0             1             0             3
 181  2022:07:20:10:30:00          3          0          3          2          0             0             0             5
 182  2022:07:20:10:15:00          4          0          4          3          0             0             0             7
 183  2022:07:20:10:00:00          2          0          2          2          0             0             0             4
 184  2022:07:20:09:45:00          4          0          2          2          0             6             0            12
 185  2022:07:20:09:30:00          2          0          2          2          0             0             0             4
 186  2022:07:20:09:15:00          2          0          2          2          0             0             0             4
 187  2022:07:20:09:00:00          2          0          2          2          0             2             0             6
 188  2022:07:20:08:45:00          1          0          1          1          0             0             0             2
 189  2022:07:20:08:30:00          2          0          2          2          0             0             0             4
 190  2022:07:20:08:15:00          3          0          3          3          0             2             0             8
 191  2022:07:20:08:00:00          1          0          1          1          0             2             0             4
 192  2022:07:20:07:45:00          2          0          2          2          0             2             0             6            
    
    """

    def cli(self, output=None):
        if output is None:
            out = self.device.execute(self.cli_command)
        else:
            out = output

        # initial return dictionary
        recovery_dict = {}
        
        result_dict = {}

        # initial regexp pattern
        p0 = re.compile(r'(?P<intv>\d+)\s+(?P<timestamp>\d+.\d+.\d+.\d+.\d+.\d+)\s+(?P<arrived>\d+)\s+(?P<rejected>\d+)\s+(?P<connected>\d+)\s+(?P<disconn>\d+)\s+(?P<failed>\d+)')
        for line in out.splitlines():
            line = line.strip()

            m = p0.match(line)
            if m:
                if 'session_counters_historical_all' not in recovery_dict:
                    result_dict = recovery_dict.setdefault('session_counters_historical_all',{})
                intv = m.groupdict()['intv']
                timestamp = m.groupdict()['timestamp']
                arrived = m.groupdict()['arrived']
                rejected = m.groupdict()['rejected']
                connected = m.groupdict()['connected']
                disconn = m.groupdict()['disconn']
                failed = m.groupdict()['failed']
                result_dict[intv] = {}
                result_dict[intv]['TIMESTAMP'] = timestamp
                result_dict[intv]['ARRIVED'] = arrived
                result_dict[intv]['REJECTED'] = rejected
                result_dict[intv]['CONNECTED'] = connected
                result_dict[intv]['DISCONN'] = disconn
                result_dict[intv]['FAILED'] = failed          
                continue

        return recovery_dict